<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ROS Index</title>
    <meta name="description" content="a community-maintained index of robotics software
">

    
    <link rel="canonical" href="https://ros-infrastructure.github.io/index.ros.org//r/lidar_camera_calibration/github-ankitdhall-lidar_camera_calibration/">
    
    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/sphinx.css">
    

    <script type="text/javascript" src=/js/jquery.js></script>
    <script src=/bootstrap/js/bootstrap.min.js type="text/javascript"></script>
    <script src=/js/jquery-cookie-1.4.1/jquery.cookie.js type="text/javascript"></script>

    <script type="text/javascript" src=/js/ga.js async></script>
    <script type="text/javascript" src=/js/toc.js></script>

    <script src=/js/distro_switch.js></script>
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">
    <div class="container-fluid" style="margin-bottom: 10px">

      <div align="center">
        <br>
        <table id="topnav-table">
          <tr>
            <td valign="middle">
                ROS Resources:
              <a href="http://wiki.ros.org/">Documentation</a>
              |
              <a href="http://wiki.ros.org/Support">Support</a>
              |
              <a href="http://discourse.ros.org/">Discussion Forum</a>
              |
              <a href="http://status.ros.org/">Service Status</a>
              |
              <a href="http://answers.ros.org/">Q&A answers.ros.org</a>
            </td>
          </tr>
        </table> <!-- topnav-table -->
      </div>

      <div class="row">

        <div class="col-sm-12 col-md-9" style="margin-top: 8px">
          <div class="row">
            <!-- title -->
            <div class="col-xs-12 col-sm-3 col-md-3" style="white-space:nowrap;">
              <a class="site-title" href="/">ROS Index</a> <sup><a href="https://github.com/ros-infrastructure/rosindex/issues/new" style="vertical-align:super;" class="label label-warning" target="_blank">BETA</a></sup>
            </div>

            <!-- main links -->
            <div class="col-xs-12 col-sm-9 col-md-9 text-right">
              <ul class="list-inline" style="margin-bottom:0px;">
                <li><a class="btn btn-link" href="/about">About</a></li>

                <li class="dropdown">
                  <button id="dLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Index <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                    <li><a href="/packages/page/1/time/">Package List</a></li>
                    <li><a href="/repos/page/1/time/">Repository List</a></li>

                    <li class="hidden" class="divider"></li>


                    <li class="hidden"><a href="/srvs/">Nodes</a></li>
                    <li class="hidden"><a href="/msgs/">Messages</a></li>
                    <li class="hidden"><a href="/srvs/">Services</a></li>
                    <li class="hidden"><a href="/srvs/">Plugins</a></li>

                    <li class="divider"></li>

                    <li><a href="/deps/">System Dependencies</a></li>
                  </ul>
                </li>

                <li class="dropdown disabled">
                  <button id="dLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Doc <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                    
                    <li>
                      <a href="/doc/ros2">
                        ROS2 Overview
                      </a>
                    </li>
                    
                    <li class="hidden" class="divider"></li>

                    <li class="hidden"><a href="/doc/tutorials">Tutorials</a></li>
                    <li class="hidden"><a href="/doc/readmes">Readmes</a></li>
                    <li class="hidden"><a href="/doc/apis">APIs</a></li>
                  </ul>
                </li>

                <li><a class="btn btn-link" href="/contribute">Contribute</a></li>
                <li><a class="btn btn-link" href="/stats">Stats</a></li>
              </ul>

            </div>
          </div>
        </div>

        <!-- searchbox -->
        <div class="col-sm-12 col-md-3" style="margin-top: 12px">
          <form id="top-searchbox" action="/search/" role="form" method="get">
            <div class="input-group input-group-sm">
              <input type="text" class="form-control" name="term" placeholder="Search ROS">
              <span class="input-group-btn">
                <button class="btn btn-default btn-sm" title="Search ROS" type="submit">
                  <span class="glyphicon glyphicon-search"></span>
                </button>
                <a href="https://lunrjs.com/guides/searching.html"
                   title="Help to Search" class="btn btn-default btn-sm">
                  <span class="glyphicon glyphicon-question-sign"></span>
                </a>
              </span>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!--
    <a class="site-title" href="/">ROS Index</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        <a class="page-link" href="/packages">Packages</a>
        <a class="page-link" href="/repos">Repositories</a>
        <a class="page-link" href="/search">Search</a>
      </div>
    </nav>
    -->

  </div>
  <script type="text/javascript">
    $('#top-searchbox').submit(function() {
        return $('#top-searchbox input:text').filter(function() {
          return $(this).val() == "";
        }).length == 0;
    });
  </script>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="container-fluid" style="margin-top:20px">
  <div class="container-fluid">
    <div class="row">
      <ol class="breadcrumb">
        <li><a href="/">Home</a></li>
        <li><a href="/repos">Repos</a></li>
        <li class="active">lidar_camera_calibration</li>
        <!--<li class="active">lidar_camera_calibration</li>-->
      </ol>
    </div>
    <div class="row">
      

<div id="distro-switch" class="btn-group btn-group-justified" data-toggle="buttons">
  
    <label id="crystal-option" class="distro-button btn btn-xs btn-default" href="#crystal" data="crystal">
      <input type="radio" name="options" id="crystal-radio" autocomplete="off"> crystal
    </label>
  
    <label id="bouncy-option" class="distro-button btn btn-xs btn-default" href="#bouncy" data="bouncy">
      <input type="radio" name="options" id="bouncy-radio" autocomplete="off"> bouncy
    </label>
  
    <label id="melodic-option" class="distro-button btn btn-xs btn-default" href="#melodic" data="melodic">
      <input type="radio" name="options" id="melodic-radio" autocomplete="off"> melodic
    </label>
  
    <label id="lunar-option" class="distro-button btn btn-xs btn-default" href="#lunar" data="lunar">
      <input type="radio" name="options" id="lunar-radio" autocomplete="off"> lunar
    </label>
  
    <label id="kinetic-option" class="distro-button btn btn-xs btn-primary" href="#kinetic" data="kinetic">
      <input type="radio" name="options" id="kinetic-radio" autocomplete="off"> kinetic
    </label>
  
    <label id="indigo-option" class="distro-button btn btn-xs btn-default" href="#indigo" data="indigo">
      <input type="radio" name="options" id="indigo-radio" autocomplete="off"> indigo
    </label>
  

  <!-- Older distros -->
  <div class="btn-group dropdown">
    <label type="button" class="btn btn-xs dropdown-toggle btn-default" data-toggle="dropdown" id="older-distro-button">
        <input type="radio" name="options" autocomplete="off">
      <span id="older-label">Older</span>
      <span class="caret"></span>
    </label>
    <ul class="dropdown-menu" role="menu">
      
        <li data="ardent" id="ardent-option" class="disabled older-distro-option"  href="#ardent">
          <a href="#ardent" data="ardent" id="ardent-button">ardent</a>
        </li>
      
        <li data="jade" id="jade-option" class="disabled older-distro-option"  href="#jade">
          <a href="#jade" data="jade" id="jade-button">jade</a>
        </li>
      
        <li data="hydro" id="hydro-option" class="disabled older-distro-option"  href="#hydro">
          <a href="#hydro" data="hydro" id="hydro-button">hydro</a>
        </li>
      
    </ul>
  </div>
</div>

    </div>
    <div class="row">
      &nbsp;
    </div>
    <div class="row">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/lidar_camera_calibration">lidar_camera_calibration</a> <small>repository</small></h3>
        
      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 50px">
          <a type="button" class="btn btn-xs btn-default" data-toggle="tooltip" data-placement="left" title="View Instances" 
            href="/repos/lidar_camera_calibration"><span class="glyphicon glyphicon-th"></span></a>
        </div>
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ankitdhall-lidar_camera_calibration
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ankitdhall-lidar_camera_calibration" role="menuitem" tabindex="-1" href="/r/lidar_camera_calibration/github-ankitdhall-lidar_camera_calibration" data="github-ankitdhall-lidar_camera_calibration">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ankitdhall-lidar_camera_calibration
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

    </div>
  </div>
</div>


  <div class="distro distro-crystal">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>crystal</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-bouncy">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>bouncy</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-melodic">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>melodic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-lunar">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>lunar</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-kinetic">
    <div class="container-fluid">
      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            

  <table class="table table-condensed">
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/ankitdhall/lidar_camera_calibration.git">https://github.com/ankitdhall/lidar_camera_calibration.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">master</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2018-06-02
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          <span class="label label-warning">UNMAINTAINED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-default">UNRELEASED
        </span>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/lidar_camera_calibration/github-ankitdhall-lidar_camera_calibration">lidar_camera_calibration</a></td>
                    <td>0.0.1</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="ros-package-to-calibrate-a-camera-and-a-lidar">ROS package to calibrate a camera and a LiDAR.</h1>

<p><img src="https://raw.githubusercontent.com/ankitdhall/lidar_camera_calibration/master/images/pcl.png" alt="alt text" title="Pointcloud of the setup"></p>

<p>The package is used to calibrate a Velodyne LiDAR with a camera (works for both monocular and stereo). Specficially, Point Gray Blackfly and ZED camera have been successfully calibrated against Velodyne VLP-16 using <code>lidar_camera_calibration</code>. Since, VLP-16 provides only 16 rings, we believe that the higher models of the Velodyne will also work well with this package. We show the accuracy of the proposed pipeline by fusing point clouds, with near perfection, from multiple cameras kept in various positions. See <a href="https://github.com/ankitdhall/lidar_camera_calibration/tree/master/#fusion-using-lidar_camera_calibration">Fusion using <code>lidar_camera_calibration</code></a> for results of the point cloud fusion (videos).</p>

<p>The package finds a rotation and translation that transform all the points in the LiDAR frame to the (monocular) camera frame. Please see <a href="https://github.com/ankitdhall/lidar_camera_calibration/tree/master/#usage">Usage</a> for a video tutorial.</p>

<p>The package uses <code>aruco_ros</code> and a slightly modified <code>aruco_mapping</code> as dependencies, both of which are available in the <code>dependencies</code> folder in this repository.</p>

<p>The <code>lidar_camera_calibration/pointcloud_fusion</code> provides a script to fuse point clouds obtained from two stereo cameras. Both of which were extrinsically calibrated using a LiDAR and <code>lidar_camera_calibration</code>.  </p>

<p>For more details please refer to our <a href="http://arxiv.org/abs/1705.09785">arXiv paper</a>.</p>

<h3 id="citing-lidar_camera_calibration">Citing <code>lidar_camera_calibration</code>
</h3>

<p>Please cite our work if <code>lidar_camera_calibration</code> and our approach helps your research.  </p>
<div class="highlight"><pre><code class="language-" data-lang="">@article{2017arXiv170509785D,
   author = {{Dhall}, A. and {Chelani}, K. and {Radhakrishnan}, V. and {Krishna}, K.~M.
    },
    title = "{LiDAR-Camera Calibration using 3D-3D Point correspondences}",
  journal = {ArXiv e-prints},
archivePrefix = "arXiv",
   eprint = {1705.09785},
 primaryClass = "cs.RO",
 keywords = {Computer Science - Robotics, Computer Science - Computer Vision and Pattern Recognition},
     year = 2017,
    month = may
}

</code></pre></div>
<h2 id="contents">Contents</h2>

<ol>
<li><a href="https://github.com/ankitdhall/lidar_camera_calibration/tree/master/#setup">Setup</a></li>
<li><a href="https://github.com/ankitdhall/lidar_camera_calibration/tree/master/#getting-started">Getting Started</a></li>
<li><a href="https://github.com/ankitdhall/lidar_camera_calibration/tree/master/#usage">Usage</a></li>
<li><a href="https://github.com/ankitdhall/lidar_camera_calibration/tree/master/#fusion-using-lidar_camera_calibration">Fusion using <code>lidar_camera_calibration</code></a></li>
<li><a href="https://github.com/ankitdhall/lidar_camera_calibration/tree/master/#future-improvements">Future Improvements</a></li>
</ol>

<h2 id="setup">Setup</h2>

<p>Prerequisites:</p>

<ul>
<li>
<a href="http://www.ros.org/">ROS</a><br>
</li>
<li>
<a href="https://github.com/pal-robotics/aruco_ros">aruco_ros</a><br>
</li>
<li>a slightly modified <a href="https://github.com/SmartRoboticSystems/aruco_mapping">aruco_mapping</a><br>
</li>
</ul>

<p>ROS package for the camera and LiDAR you wish to calibrate.  </p>

<h3 id="installation">Installation</h3>

<p>Clone this repository to your machine.<br>
Put the cloned repository, <code>dependencies/aruco_ros</code> and <code>dependencies/aruco_mapping</code> folders in <code>path/to/your/ros/workspace/src</code> and run the following commands,</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">catkin_make <span class="nt">-DCATKIN_WHITELIST_PACKAGES</span><span class="o">=</span><span class="s2">"aruco;aruco_ros;aruco_msgs"</span>
catkin_make <span class="nt">-DCATKIN_WHITELIST_PACKAGES</span><span class="o">=</span><span class="s2">"aruco_mapping;lidar_camera_calibration"</span>
catkin_make <span class="nt">-DCATKIN_WHITELIST_PACKAGES</span><span class="o">=</span><span class="s2">""</span>

</code></pre></div>
<p>Please note that <code>aruco_mapping</code> in the <code>dependencies</code> folder is a slightly modified version of the original <a href="https://github.com/SmartRoboticSystems/aruco_mapping">aruco_mapping</a>, so make sure to use the one provided here. The aruco packages have to be installed before the main calibration package can be installed. Installing them together, in one run, can result in build errors. Hence the two separate <code>catkin_make</code> commands.</p>

<p>Camera parameters will also be required by the package, so it is advised that you calibrate the camera beforehand.</p>

<h2 id="getting-started">Getting Started</h2>

<p><img src="https://raw.githubusercontent.com/ankitdhall/lidar_camera_calibration/master/images/setup_view1.jpg" width="432"> <img src="https://raw.githubusercontent.com/ankitdhall/lidar_camera_calibration/master/images/setup_view2.jpg" width="432"></p>

<p>There are a couple of configuration files that need to be specfied in order to calibrate the camera and the LiDAR. The config files are available in the <code>lidar_camera_calibration/conf</code> directory. The <code>find_transform.launch</code> file is available in the <code>lidar_camera_calibration/launch</code> directory.</p>

<h3 id="config_file-txt">config_file.txt</h3>

<blockquote>
<p>1280 720<br>
-2.5 2.5<br>
-4.0 4.0<br>
0.0 2.5<br>
0.05<br>
2<br>
0<br>
611.651245 0.0        642.388357 0.0<br>
0.0        688.443726 365.971718 0.0<br>
0.0        0.0        1.0        0.0<br>
1.57 -1.57 0.0</p>
</blockquote>

<p>The file contains specifications about the following:</p>

<blockquote>
<p>image_width image_height<br>
x- x+<br>
y- y+<br>
z- z+<br>
cloud_intensity_threshold<br>
number_of_markers<br>
use_camera_info_topic?<br>
fx     0       cx      0<br>
0      fy      cy      0<br>
0      0       1       0</p>

<p>MAX_ITERS</p>

<p>initial_rot_x initial_rot_y initial_rot_z</p>
</blockquote>

<p><code>x-</code> and <code>x+</code>, <code>y-</code> and <code>y+</code>, <code>z-</code> and <code>z+</code> are used to remove unwanted points in the cloud and are specfied in meters. The filtred point cloud makes it easier to mark the board edges. The filtered pointcloud contains all points<br>
(x, y, z) such that,<br>
x in [<code>x-</code>, <code>x+</code>]<br>
y in [<code>y-</code>, <code>y+</code>]<br>
z in [<code>z-</code>, <code>z+</code>]  </p>

<p>The <code>cloud_intensity_threshold</code> is used to filter points that have intensity lower than a specified value. The default value at which it works well is <code>0.05</code>. However, while marking, if there seem to be missing/less points on the cardboard edges, tweaking this value will might help.</p>

<p>The <code>use_camera_info_topic?</code> is a boolean flag and takes values <code>1</code> or <code>0</code>. The <code>find_transform.launch</code> node uses camera parameters to process the points and display them for marking. If you wish to use the <code>camera_info</code> topic to read off the parameters, set this to <code>1</code>. Else, the explicitly provided camera parameters in <code>config_file.txt</code> are used.</p>

<p><code>MAX_ITERS</code> is the number of iterations, you wish to run. The current pipeline assumes that the experimental setup: the boards are almost stationary and the camera and the LiDAR are fixed. The node will ask the user to mark the line-segments (see the video tutorial on how to go about marking <a href="https://github.com/ankitdhall/lidar_camera_calibration/tree/master/#usage">Usage</a>) for the first iteration. Once, the line-segments for each board have been marked, the algorithm runs for <code>MAX_ITERS</code>, collecting live data and producing n=<code>MAX_ITERS</code> sets of rotation and translation in the form of 4x4 matrix. Since, the marking is only done initially, the quadrilaterals should be drawn large enough such that if in the iterations that follow the boards move slightly (say, due to a gentle breeze) the edge points still fall in their respective quadrilaterals. After running for <code>MAX_ITERS</code> number of times, the node outputs an average translation vector (3x1) and an average rotation matrix (3x3). Averaging the translation vector is trivial; the rotations matrices are converted to quaternions and averaged, then converted back to a 3x3 rotation matrix.</p>

<p>The last line is used to specify the initial orientation of the lidar with respect to the camera, in radians. The default values are for the case when both the lidar and the camera are both pointing forward. The final transformation that is estimated by the package accounts for this initial rotation.</p>

<h3 id="marker_coordinates-txt">marker_coordinates.txt</h3>

<p>The ArUco markers are stuck on the board such that when it is hung from a corner, the ArUco marker is on the left side of the board.</p>

<p>After everything is setup, it should look something like this. Notice how the axis are aligned. <code>y-axis</code> should point outwards, <code>x-axis</code> along the <code>breadth (s2)</code> and <code>z-axis</code> along the <code>length (s1)</code>. The markers are also arranged so that the <code>ArUco id</code> are in ascending order.
<img src="https://raw.githubusercontent.com/ankitdhall/lidar_camera_calibration/master/images/aruco_axis.png" alt="alt text" title="Axis of the ArUco markers as seen from aruco_mapping"></p>

<blockquote>
<p>2<br>
48.4<br>
46.8<br>
4.0<br>
5.0<br>
20.5<br>
49.0<br>
46.8<br>
4.0<br>
5.0<br>
20.5  </p>
</blockquote>

<p>After sticking the ArUco marker on a planar cardboard, it will look like this.
<img src="https://raw.githubusercontent.com/ankitdhall/lidar_camera_calibration/master/images/board_dim_label.jpg" alt="alt text" title="Reference image for board dimensions"></p>

<p>The first line specfies 'N' the number of boards being used. Followed by N*5 lines with the following information about the dimensions of the board:</p>

<blockquote>
<p>length (s1)<br>
breadth (s2)<br>
border_width_along_length (b1)<br>
border_width_along_breadth (b2)<br>
edge_length_of_ArUco_marker (e)  </p>
</blockquote>

<p>All dimensions in <code>marker_coordinates.txt</code> are in centimeters.</p>

<h3 id="lidar_camera_calibration-yaml">lidar_camera_calibration.yaml</h3>

<blockquote>
<p>lidar_camera_calibration:<br>
 camera_frame_topic: /frontNear/left/image_raw<br>
 camera_info_topic: /frontNear/left/camera_info<br>
 velodyne_topic: /velodyne_points</p>
</blockquote>

<p>Contains name of camera and velodyne topics that the node will subscribe to.</p>

<h3 id="find_transform-launch">find_transform.launch</h3>

<p>Parameters are required for the <code>aruco_mapping</code> node and need to be specfied here. Ensure that the topics are mapped correctly for the node to function.
Other parameters required are:<br>
* calibration_file(.ini format)<br>
* num_of_markers<br>
* marker_size(in meters)  </p>

<p>For more information about the <code>aruco_mapping</code> package refer to their <a href="https://github.com/SmartRoboticSystems/aruco_mapping">documentation</a>.</p>

<h2 id="usage">Usage</h2>

<p>A more detailed video tutorial on how to go about using the node can be found at <a href="https://youtu.be/SiPGPwNKE-Q">https://youtu.be/SiPGPwNKE-Q</a>.</p>

<p>Before launching the calibration node ensure that the ArUco markers are visible in the camera frame and the markers are arragned in ascending order of their <code>ArUco ids</code> (<code>ArUco ids</code> and their co-ordinate frame can be found/viewed by running the original <code>aruco_mapping</code> <a href="https://github.com/SmartRoboticSystems/aruco_mapping">package</a>) from left to right as viewed by the camera.</p>

<p>Use the following command to start the calibration process once everything is setup.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">roslaunch lidar_camera_calibration find_transform.launch

</code></pre></div>
<p>An initial [R|t] between the camera and the various ArUco markers will be estimated. Following this, a filtered point cloud (according to the specifications in the <code>config_file.txt</code>) will be displayed. The user needs to mark each edge of the rectangular board.</p>

<p>Each board will have 4 line segments and need to be marked from leftmost board to the rightmost board. Marking a line segment is quite straight-forward, one needs to draw a quadrilateral around the line being marked. Click and press a key to confirm the corner of the quadrilateral. Once 4 points are clicked, each followed by a key-press, the program will move on to the next line segment. Continue marking the line segments for all boards until complete.
Line segments for each board are to be marked in clock-wise order starting from the top-left.</p>

<p>After marking all the line-segments, the rigid-body transformation between the camera and the LiDAR frame will be displayed.</p>

<p>Intermediate values are logged in <code>conf/points.txt</code>.</p>

<h3 id="points-txt">points.txt</h3>

<p>This contains <code>num_of_sensors*(num_of_markers*points_per_board)</code> 3D points, here, <code>num_of_sensors</code> is fixed to 2 and the <code>points_per_board</code>=4, the four corner points.<br>
So if <code>num_of_markers</code> = 2, then,<br>
* the first 4 points represent the first board,<br>
* next 4 points represent the second board,<br>
both of which are 3D co-ordinates in meters, viewed from the <code>lidar</code> origin.<br>
* the next 4 points represent the first board,<br>
* the next 4 points represent the second board,<br>
both of which are 3D co-ordinates in meters, viewed from the <code>camera</code> origin.<br>
The points are ordered according to their correspondences, i.e. the second point in the first 8 points has a correspondence with the second point in the last 8 points in this case.</p>

<h2 id="fusion-using-lidar_camera_calibration">Fusion using <code>lidar_camera_calibration</code>
</h2>

<p>To verify the method in a more intuitive manner, <code>lidar_camera_calibration</code> was used to fuse point clouds obtained from two stereo cameras.  </p>

<h3 id="manual-measurement-vs-lidar_camera_calibration">Manual measurement vs. <code>lidar_camera_calibration</code>
</h3>

<p>First, we compare the calibration parameters obtained from <code>lidar_camera_calibration</code> against meticulously measured values using tape by a human. The setup looked something like the this:</p>

<p><img src="https://raw.githubusercontent.com/ankitdhall/lidar_camera_calibration/master/images/setup_mm1.jpg" width="432"> <img src="https://raw.githubusercontent.com/ankitdhall/lidar_camera_calibration/master/images/setup_mm2.jpg" width="432"></p>

<p>The fused point cloud obtained when using manual measurements versus when using <code>lidar_camera_calibration</code> is shown in the video. Notice the large translation error, even when the two cameras are kept on a planar surface. Hallucinations of markers, cupboards and carton box (in the background) can be seen as a result of the two point clouds not being aligned properly.  </p>

<p>On the other hand, rotation and translation estimated by <code>lidar_camera_calibration</code> almost perfectly fuses the two individual point clouds. There is a very minute translation error (~1-2cm) and almost no rotation error. The fused point cloud is aligned so properly, that one might actually believe that it is a single point cloud, but it actually consists of 2 clouds fused using extrinsic transformation between their sources (the stereo cameras).</p>

<p>The resultant fused point clouds from both manual and <code>lidar_camera_calibration</code> methods can be seen in <a href="https://youtu.be/AbjRDtHLdz0">this video</a>.</p>

<h3 id="calibrating-cameras-kept-at-80-degrees">Calibrating cameras kept at ~80 degrees</h3>

<p>We also wanted to see the potential of this method and used it to calibrate cameras kept at ~80 degrees and almost no overlapping field-of-view. In principle, with a properly designed experimental setup our method can calibrate cameras with zero overlapping field of view.  </p>

<p>However, to visualize the fusion, we needed a part to be common in both point clouds. We chose a large checkerboard to be seen in both FOVs, since it can be used to see how well the point clouds have aligned and if the dimensions of the checkerboard squares are known, one can even estimate the translation errors.</p>

<p>The setup for such an experiment looked something like this:<br>
<img src="https://raw.githubusercontent.com/ankitdhall/lidar_camera_calibration/master/images/deg801.jpg" width="275"> <img src="https://raw.githubusercontent.com/ankitdhall/lidar_camera_calibration/master/images/deg802.jpg" width="275"> <img src="https://raw.githubusercontent.com/ankitdhall/lidar_camera_calibration/master/images/deg803.jpg" width="275">  </p>

<p>There is very less translation error, about 3-4 cm. Also, the ground planes align properly, at all distances, near and far from the camera, implying that the rotations estimated are correct.  </p>

<p>The resultant fused point clouds after extrinsic calibration of stereo cameras kept at ~80 degrees using <code>lidar_camera_calibration</code> can be seen in <a href="https://youtu.be/Om1SFPAZ5Lc">this video</a>.  </p>

<p>We believe, that better intrinsic calibration of the cameras can help drive down the error to about 1 centimeter or even less.</p>

<h2 id="future-improvements">Future improvements</h2>

<ul>
<li>[x] iterative process with ~~weighted~~ average over multiple runs</li>
<li>[ ] automate process of marking line-segments</li>
</ul>
</div>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-indigo">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>indigo</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-ardent">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>ardent</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-jade">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>jade</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-hydro">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>hydro</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>


<script type="text/javascript">
  $(document).ready(function() {
    setupDistroSwitch("crystal");
  });
</script>

      </div>
    </div>

    <footer class="site-footer">
  <div class="wrapper">
    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-4 col-md-4">
          
            <a href="https://github.com/ros-infrastructure" title="Find rosindex in Github">
            <span class="icon  icon--github">
              <svg viewBox="0 0 16 16">
                <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>

            <span class="username">ros-infrastructure</span>
          </a>
          |
          <em>generated on 2019-05-24</em>
        
        </div>
        <div class="col-sm-8 col-md-8 text-right">
          <p class="text">a community-maintained index of robotics software
 | <a href="/privacy.txt">privacy</a></p>
        </div>
      </div>
    </div>
  </div>

</footer>


  </body>

</html>
