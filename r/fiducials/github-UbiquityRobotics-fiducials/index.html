<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ROS Index</title>
    <meta name="description" content="a community-maintained index of robotics software
">

    <link rel="canonical" href="https://ros-infrastructure.github.io/index.ros.org//r/fiducials/github-UbiquityRobotics-fiducials/">
    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/main.css">
    

    <script type="text/javascript" src=/js/jquery.js></script>
    <script src=/bootstrap/js/bootstrap.min.js type="text/javascript"></script>
    <script src=/js/jquery-cookie-1.4.1/jquery.cookie.js type="text/javascript"></script>

    <script type="text/javascript" src=/js/ga.js async></script>
    <script type="text/javascript" src=/js/toc.js></script>

    <script src=/js/distro_switch.js></script>
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">
    <div class="container-fluid" style="margin-bottom: 10px">

      <div align="center">
        <br>
        <table id="topnav-table">
          <tr>
            <td valign="middle">
                ROS Resources:
              <a href="http://wiki.ros.org/">Documentation</a>
              |
              <a href="http://wiki.ros.org/Support">Support</a>
              |
              <a href="http://discourse.ros.org/">Discussion Forum</a>
              |
              <a href="http://status.ros.org/">Service Status</a>
              |
              <a href="http://answers.ros.org/">Q&A answers.ros.org</a>
            </td>
          </tr>
        </table> <!-- topnav-table -->
      </div>

      <div class="row">

        <div class="col-sm-12 col-md-9" style="margin-top: 8px">
          <div class="row">
            <!-- title -->
            <div class="col-xs-12 col-sm-3 col-md-3" style="white-space:nowrap;">
              <a class="site-title" href="/">ROS Index</a> <sup><a href="https://github.com/ros-infrastructure/rosindex/issues/new" style="vertical-align:super;" class="label label-warning" target="_blank">BETA</a></sup>
            </div>

            <!-- main links -->
            <div class="col-xs-12 col-sm-9 col-md-9 text-right">
              <ul class="list-inline" style="margin-bottom:0px;">
                <li><a class="btn btn-link" href="/about">About</a></li>

                <li class="dropdown">
                  <button id="dLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Index <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                    <li><a href="/packages/page/1/time/">Package List</a></li>
                    <li><a href="/repos/page/1/time/">Repository List</a></li>

                    <li class="hidden" class="divider"></li>


                    <li class="hidden"><a href="/srvs/">Nodes</a></li>
                    <li class="hidden"><a href="/msgs/">Messages</a></li>
                    <li class="hidden"><a href="/srvs/">Services</a></li>
                    <li class="hidden"><a href="/srvs/">Plugins</a></li>

                    <li class="divider"></li>

                    <li><a href="/deps/">System Dependencies</a></li>
                  </ul>
                </li>

                <li class="dropdown disabled">
                  <button id="dLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Doc <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                    
                    <li>
                      <a href="/doc/ros2">
                        ROS2 Overview
                      </a>
                    </li>
                    
                    <li class="hidden" class="divider"></li>

                    <li class="hidden"><a href="/doc/tutorials">Tutorials</a></li>
                    <li class="hidden"><a href="/doc/readmes">Readmes</a></li>
                    <li class="hidden"><a href="/doc/apis">APIs</a></li>
                  </ul>
                </li>

                <li><a class="btn btn-link" href="/contribute">Contribute</a></li>
                <li><a class="btn btn-link" href="/stats">Stats</a></li>
              </ul>

            </div>
          </div>
        </div>

        <!-- searchbox -->
        <div class="col-sm-12 col-md-3" style="margin-top: 12px">
          <form id="top-searchbox" action="/search/" role="form" method="get">
            <div class="input-group input-group-sm">
              <input type="text" class="form-control" name="term" placeholder="Search ROS">
              <span class="input-group-btn">
                <button class="btn btn-default btn-sm" title="Search ROS" type="submit">
                  <span class="glyphicon glyphicon-search"></span>
                </button>
                <a href="https://lunrjs.com/guides/searching.html"
                   title="Help to Search" class="btn btn-default btn-sm">
                  <span class="glyphicon glyphicon-question-sign"></span>
                </a>
              </span>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!--
    <a class="site-title" href="/">ROS Index</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        <a class="page-link" href="/packages">Packages</a>
        <a class="page-link" href="/repos">Repositories</a>
        <a class="page-link" href="/search">Search</a>
      </div>
    </nav>
    -->

  </div>
  <script type="text/javascript">
    $('#top-searchbox').submit(function() {
        return $('#top-searchbox input:text').filter(function() {
          return $(this).val() == "";
        }).length == 0;
    });
  </script>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="container-fluid" style="margin-top:20px">
  <div class="container-fluid">
    <div class="row">
      <ol class="breadcrumb">
        <li><a href="/">Home</a></li>
        <li><a href="/repos">Repos</a></li>
        <li class="active">fiducials</li>
        <!--<li class="active">fiducials</li>-->
      </ol>
    </div>
    <div class="row">
      

<div id="distro-switch" class="btn-group btn-group-justified" data-toggle="buttons">
  
    <label id="crystal-option" class="distro-button btn btn-xs btn-default" href="#crystal" data="crystal">
      <input type="radio" name="options" id="crystal-radio" autocomplete="off"> crystal
    </label>
  
    <label id="bouncy-option" class="distro-button btn btn-xs btn-default" href="#bouncy" data="bouncy">
      <input type="radio" name="options" id="bouncy-radio" autocomplete="off"> bouncy
    </label>
  
    <label id="melodic-option" class="distro-button btn btn-xs btn-default" href="#melodic" data="melodic">
      <input type="radio" name="options" id="melodic-radio" autocomplete="off"> melodic
    </label>
  
    <label id="lunar-option" class="distro-button btn btn-xs btn-default" href="#lunar" data="lunar">
      <input type="radio" name="options" id="lunar-radio" autocomplete="off"> lunar
    </label>
  
    <label id="kinetic-option" class="distro-button btn btn-xs btn-primary" href="#kinetic" data="kinetic">
      <input type="radio" name="options" id="kinetic-radio" autocomplete="off"> kinetic
    </label>
  
    <label id="indigo-option" class="distro-button btn btn-xs btn-primary" href="#indigo" data="indigo">
      <input type="radio" name="options" id="indigo-radio" autocomplete="off"> indigo
    </label>
  

  <!-- Older distros -->
  <div class="btn-group dropdown">
    <label type="button" class="btn btn-xs dropdown-toggle btn-default" data-toggle="dropdown" id="older-distro-button">
        <input type="radio" name="options" autocomplete="off">
      <span id="older-label">Older</span>
      <span class="caret"></span>
    </label>
    <ul class="dropdown-menu" role="menu">
      
        <li data="ardent" id="ardent-option" class="disabled older-distro-option"  href="#ardent">
          <a href="#ardent" data="ardent" id="ardent-button">ardent</a>
        </li>
      
        <li data="jade" id="jade-option" class="disabled older-distro-option"  href="#jade">
          <a href="#jade" data="jade" id="jade-button">jade</a>
        </li>
      
        <li data="hydro" id="hydro-option" class="disabled older-distro-option"  href="#hydro">
          <a href="#hydro" data="hydro" id="hydro-button">hydro</a>
        </li>
      
    </ul>
  </div>
</div>

    </div>
    <div class="row">
      &nbsp;
    </div>
    <div class="row">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/fiducials">fiducials</a> <small>repository</small></h3>
        
      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 50px">
          <a type="button" class="btn btn-xs btn-default" data-toggle="tooltip" data-placement="left" title="View Instances" 
            href="/repos/fiducials"><span class="glyphicon glyphicon-th"></span></a>
        </div>
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-UbiquityRobotics-fiducials
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-UbiquityRobotics-fiducials" role="menuitem" tabindex="-1" href="/r/fiducials/github-UbiquityRobotics-fiducials" data="github-UbiquityRobotics-fiducials">
                    <span class="glyphicon glyphicon-star"></span>
                    github-UbiquityRobotics-fiducials
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

    </div>
  </div>
</div>


  <div class="distro distro-crystal">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>crystal</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-bouncy">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>bouncy</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-melodic">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>melodic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-lunar">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>lunar</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-kinetic">
    <div class="container-fluid">
      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            

  <table class="table table-condensed">
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/UbiquityRobotics/fiducials.git">https://github.com/UbiquityRobotics/fiducials.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">kinetic-devel</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2019-01-04
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/aruco_detect/github-UbiquityRobotics-fiducials">aruco_detect</a></td>
                    <td>0.10.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fiducial_msgs/github-UbiquityRobotics-fiducials">fiducial_msgs</a></td>
                    <td>0.10.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fiducial_slam/github-UbiquityRobotics-fiducials">fiducial_slam</a></td>
                    <td>0.10.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fiducials/github-UbiquityRobotics-fiducials">fiducials</a></td>
                    <td>0.10.0</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="simultaneous-localization-and-mapping-using-fiducial-markers">Simultaneous Localization and Mapping Using Fiducial Markers</h1>

<p>Travis:  <a href="https://travis-ci.org/UbiquityRobotics/fiducials"><img src="https://travis-ci.org/UbiquityRobotics/fiducials.svg?branch=kinetic-devel" alt="Build Status"></a></p>

<p>Jenkins: <a href="http://build.ros.org/view/Kdev/job/Kdev__fiducials__ubuntu_xenial_amd64/"><img src="http://build.ros.org/view/Kdev/job/Kdev__fiducials__ubuntu_xenial_amd64/badge/icon" alt="Build Status"></a></p>

<h2 id="overview">Overview</h2>

<p>This package implements a system that uses ceiling mounted
fiducial markers (think QR Codes) to allow a robot to identify
its location and orientation.  It does this by constructing
a map of the ceiling fiducials.  The position of one fiducial
needs to be specified, then a map of the fiducials is built 
up from observing pairs of markers in the same image. 
Once the map has been constructed, the robot can identify
its location by locating itself relative to one or more 
ceiling fiducials.</p>

<p>Documentation is at <a href="http://wiki.ros.org/fiducials">http://wiki.ros.org/fiducials</a>.</p>

<h2 id="recording-a-bag-file">Recording A Bag File</h2>

<p>Sometimes for trobleshooting purposes it is useful to record a bag 
file to capture the exact data on the topics going into and out of 
fiducials.</p>

<p>To do this, while the system is running, run <code>rosbag record -a</code>.
You can upload this bag file to a file sharing service like Google
Drive and link to it in your issue, this will help us diagnose 
the problem. </p>
</div>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-indigo">
    <div class="container-fluid">
      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            

  <table class="table table-condensed">
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/UbiquityRobotics/fiducials.git">https://github.com/UbiquityRobotics/fiducials.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">indigo-devel</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2016-11-22
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/fiducial_detect/github-UbiquityRobotics-fiducials">fiducial_detect</a></td>
                    <td>0.0.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fiducial_lib/github-UbiquityRobotics-fiducials">fiducial_lib</a></td>
                    <td>0.0.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fiducial_pose/github-UbiquityRobotics-fiducials">fiducial_pose</a></td>
                    <td>0.0.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fiducial_slam/github-UbiquityRobotics-fiducials">fiducial_slam</a></td>
                    <td>0.0.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fiducials/github-UbiquityRobotics-fiducials">fiducials</a></td>
                    <td>0.0.2</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="simultaneous-localization-and-mapping-using-fiducial-markers">Simultaneous Localization and Mapping Using Fiducial Markers</h1>

<p>Travis:  <a href="https://travis-ci.org/UbiquityRobotics/fiducials"><img src="https://travis-ci.org/UbiquityRobotics/fiducials.svg?branch=indigo-devel" alt="Build Status"></a></p>

<p>Jenkins: <a href="http://build.ros.org/job/Idev__fiducials__ubuntu_trusty_amd64/"><img src="http://build.ros.org/buildStatus/icon?job=Idev__fiducials__ubuntu_trusty_amd64" alt="Build Status"></a></p>

<h2 id="overview">Overview</h2>

<p>This package implements a system that uses ceiling mounted
fiducials (think QR Codes) to allow a robot to identify
its location and orientation.  It does this by constructing
a map of the ceiling fiducials.  Once the map has been
constructed, the robot can identify its location by locating
itself relative to one or more ceiling fiducials.</p>

<p>A
  <a href="https://docs.google.com/a/mrjim.com/document/d/1GsqAXgagWFZp891-5EDgfnYioPGjC1JdtXoIOecaQ-w">more detailed document</a>
is available that describes the system in more detail.</p>

<p>In order to use this system you will need to do the following:</p>

<ul>
<li><p>Software Installation.  You will have to install the appropriate
software.</p></li>
<li><p>Mount Ceiling Fiducials.  You will need to print and install
a number of fiduicals on your ceiling.  The fiduicals have to
be big enough that your camera can resolve them.</p></li>
<li><p>Camera Installation.  You will need to install and calibrate
an upward pointing camera. On Ubiquity Robotics robots this has already been done.</p></li>
</ul>

<h2 id="installing-software">Installing software</h2>

<p>First you must install ROS (Robot Operating System),
see <a href="http://wiki.ros.org/ROS/Installation">install ROS</a> for more details.</p>

<p>Currently you must install from source--binaries are not yet available.
First, create a ROS catkin workspace, if you don't already have one:</p>
<div class="highlight"><pre><code class="language-" data-lang=""> $ mkdir -p ~/catkin_ws/src
 $ cd ~/catkin_ws/src
 $ catkin_init_workspace
</code></pre></div>
<p>Then get the source:</p>
<div class="highlight"><pre><code class="language-" data-lang="">$ git clone https://github.com/UbiquityRobotics/fiducials 
$ git clone https://github.com/UbiquityRobotics/raspicam_node 
$ cd ..
$ catkin_make    
</code></pre></div>
<p>Install inkscape</p>
<div class="highlight"><pre><code class="language-" data-lang=""> $ sudo apt-get install inkscape
</code></pre></div>
<h2 id="generating-fiducials">Generating fiducials</h2>

<p>The fiducials are typically generated from the laptop/desktop.</p>

<p>Fiduical tags are generated using the following commands:</p>
<div class="highlight"><pre><code class="language-" data-lang="">cd /tmp
    rosrun fiducial_lib Tags num ...
</code></pre></div>
<p>Thus, the following command will generate <code>tag42.svg</code> and <code>tag43.svg</code>:</p>
<div class="highlight"><pre><code class="language-" data-lang="">    rosrun fiducial_lib Tags 42 43
</code></pre></div>
<p>To generate a 100 at a time, use the following command:</p>
<div class="highlight"><pre><code class="language-" data-lang="">    rosrun fiducial_lib Tags 17{0,1,2,3,4,5,6,7,8,9}{0,1,2,3,4,5,6,7,8,9}
</code></pre></div>
<p>This will generate <code>tag1700.svg</code> through <code>tag1799.svg</code>.</p>

<p>To convert the <code>.svg</code> files to to <code>.pdf</code> files use the<code>inkscape</code>
program and the following commands:</p>
<div class="highlight"><pre><code class="language-" data-lang="">    # Convert a single .svg to a single .pdf
    inkscape --without-gui --export-pdf=tag42.pdf tag42.svg
    # Convert a bunch at a time:
    for n in 17{0,1,2,3,4,5,6,7,8,9}{0,1,2,3,4,5,6,7,8,9} ; do \
       inkscape --without-gui --export-pdf=tag$n.pdf tag$n.svg ; \
       done
    # Merge the pdf files:
    sudo apt-get install poppler-utils
    pdfunite tag17??.pdf tags17xx.pdf
    rm tag*.svg
</code></pre></div>
<p>You can print the .pdfs using using <code>evince</code>:</p>
<div class="highlight"><pre><code class="language-" data-lang="">sudo apt-get install evince
evince tags17xx.pdf
</code></pre></div>
<h2 id="camera-installation">Camera Installation:</h2>

<p>On Ubiquity Robotics robots the camera in already installed and calibrated. For users of other robots, the process is described in an Appendix.</p>

<h2 id="map-creation">Map Creation</h2>

<p>To create an empty map file with fiducial 301 (the id of 301 is arbitrary) at the origin:</p>
<div class="highlight"><pre><code class="language-" data-lang="">    mkdir -p ~/.ros/slam
    echo '301 0.0 0.0 0.0 180.0 0.0 180.0 0.0 1' &gt; ~/.ros/slam/map.txt
</code></pre></div>
<p>The format of this file is id x y z pan tilt roll numObservations.</p>

<p>This assumes the fiducial is on the ceiling, and the 180 degree rotations are used
so that the pose of fiducials is determined in the co-ordinate system of the floor.<br>
Increased accuracy can be gained by specifying the height of the fiducial (z), 
and that this can also be determined from the output of 
<code>fiducial_slamp.py</code>.</p>

<p>It is important that the transform from base link to the camera frame is
correctly specified.  The launch files are currently in transition, but
at the moment, <code>fiducial_detect/launch/raspi_pose.launch</code> is where this transform
is specified. </p>

<h2 id="running-fiducials">Running Fiducials</h2>

<ol>
<li><p>First create an empty map as above.</p></li>
<li>
<p>In order to see the fiducials during map building, run rviz:</p>
<div class="highlight"><pre><code class="language-" data-lang="">roslaunch fiducial_detect fiducial_rviz.launch
</code></pre></div>
</li>
</ol>

<p>Note that the robot node should be running (so that the transform from odom to base_link is published)
and at aleat one of the fiducials that is in the the map should have been observed before rviz 
can display anything in the map frame.</p>

<ol>
<li>
<p>Then perform a quick map generation:</p>
<div class="highlight"><pre><code class="language-" data-lang="">roslaunch fiducial_slam fiducial_raspi_3d_map.launch
</code></pre></div>
</li>
<li>
<p>Then launch fiducial localization:</p>
<div class="highlight"><pre><code class="language-" data-lang="">roslaunch fiducial_slam fiducial_raspi_3d.launch
</code></pre></div>
</li>
<li>
<p>Finally run the navigation:</p>
<div class="highlight"><pre><code class="language-" data-lang="">roslaunch fiducial_detect navigation_noscan.launch
</code></pre></div>
</li>
</ol>

<p>At this point the robot should be capable of executing move_base and other mavigation functions.        </p>

<h2 id="visualization-with-rviz">Visualization with rviz</h2>

<p>While building the map, you should start to see something that looks as follows:</p>

<blockquote>
<p><img src="https://raw.githubusercontent.com/UbiquityRobotics/fiducials/indigo-devel/fiducials_rviz.png" alt="RViz Showing Fiducials" title="RViz Displaying Fiducials"></p>
</blockquote>

<ul>
<li><p>Red cubes represent fiducials that are currently in view
of the camera.</p></li>
<li><p>Green cubes represent fiducials that are in the map, but
not currently in the view of the camera.</p></li>
<li><p>Blue lines connect pairs of fiducials that have shown
up in the camera view at the same time.  The map is constructed
by combining fiducial pairs.</p></li>
</ul>

<h2 id="appendix-1-formats-and-programs">Appendix 1. Formats and Programs</h2>

<h2 id="file-formats">File Formats:</h2>

<h3 id="map-txt-file-format">
<code>map.txt</code> file format:</h3>

<p>The format of <code>map.txt</code> is a series of lines of the form:</p>
<div class="highlight"><pre><code class="language-" data-lang="">    id x y z pan tilt roll variance numObservations [neighbors ...]
</code></pre></div>
<h2 id="programs">Programs</h2>

<p>The program should be present in your fiducials build directory:</p>
<div class="highlight"><pre><code class="language-" data-lang="">    cd .../catkin_ws/build/fiducials
</code></pre></div>
<h3 id="tags">Tags</h3>

<p>The Tags program is used to generate .svg files for tags.  Running Tags:</p>
<div class="highlight"><pre><code class="language-" data-lang="">Tags 41 42
</code></pre></div>
<p>will generate tag41.svg and tag42.svg.  To print:</p>
<div class="highlight"><pre><code class="language-" data-lang="">inkscape --without-gui --export-pdf=tag41.pdf tag41.svg
</code></pre></div>
<h2 id="appendix-2-nodes">Appendix 2. Nodes</h2>

<h3 id="fiducial_detect-fiducial_detect">fiducial_detect fiducial_detect</h3>

<p>This node finds fiducial markers in images stream and publishes their vertices
(corner points) and estimates 3D transforms from the camera to the fiducials.
It also has 2D SLAM built in.</p>

<h4 id="parameters">Parameters</h4>

<p><strong>tag_height</strong> Name of the tag_height file (default <code>Tag_Heights.xml</code>).  This
file is used to specify the height of the fiducials for 2D slam.</p>

<p><strong>map_file</strong> Name of the file where the generated 2D SLAM-based map should be
stored (default <code>ROS_MAP</code>).</p>

<p><strong>log_file</strong> Name of the log file (default <code>fiducuals.log.txt</code>).</p>

<p><strong>data_directory</strong> Name of the directory where tag_height and map_file reside,
relative to <code>~/.ros</code>.</p>

<p><strong>odom_frame</strong> If this is set to a non-empty string, then the result of the
localization is published as a correction to odometry.
For example, the odometry publishes the tf from map to odom, and this node
publishes the tf from odom to base_link, with the tf from
map to odom removed. Default: not set.</p>

<p><strong>map_frame</strong> The name of the map (world) frame.  Default <code>map</code>.</p>

<p><strong>pose_frame</strong> The frame for our tf. Default <code>base_link</code>.</p>

<p><strong>publish_images</strong> If <code>true</code>, images containing fiducials are published. Default
<code>false</code>.</p>

<p><strong>publish_interesting_images</strong> If <code>true</code>, 'interesting' images containing fiducials are
published. Default <code>false</code>. This is for debug purposes.</p>

<p><strong>publish_tf</strong> If <code>true</code>, transforms are published. Default <code>false</code>.</p>

<p><strong>publish_markers</strong> If <code>true</code>, visualization markers are published. Default 
<code>false</code>.</p>

<p><strong>estimate_pose</strong> If <code>true</code>, 3D pose estimation is performed and fiducial
transforms are published. Default <code>true</code>.</p>

<p><strong>fiducial_len</strong> The length of one side of a fiducial in meters, used by the
pose estimation.  Default 0.146.</p>

<p><strong>undistort_points</strong> If <code>false</code>, it is assumed that the input is an undistorted
image, and the vertices are used directly to calculate the fiducial transform.
If it is <code>true</code>, then the vertices are undistorted first. This is faster, but
less accurate.  Default <code>false</code>.</p>

<p><strong>fiducials_are_level</strong> If <code>true</code>, it is assumed that all fiducials are level, as
would be the case on ceiling mounted fiducials. In this case only 3DOF are estimated.
Default <code>true</code>.</p>

<h4 id="published-topics">Published Topics</h4>

<p><strong>fiducuals</strong> A topic of <code>visualization_msgs/Marker</code> messages that can be viewed
in rviz for debugging, if that option is selected.</p>

<p><strong>vertices</strong> A topic of <code>fiducial_detect/Fiducial*</code> messages with the detected
fiducial vertices.</p>

<p><strong>fiducials_images</strong> An <code>ImageTransport*</code> of images containing fiducials, if that
option is selected.</p>

<p><strong>interesting_images</strong> <code>ImageTransport*</code> of interesting images, if that option
is selected.</p>

<p><strong>fiducial_transforms</strong> A topic of <code>fiducial_pose/FiducialTransform</code> messages 
with the computed fiducial pose.</p>

<h4 id="subscribed-topics">Subscribed Topics</h4>

<p><strong>camera</strong> An <code>ImageTransport</code> of the images to be processed.</p>

<p><strong>camera_info</strong> A topic of <code>sensor_msgs/CameraInfo</code> messages with the camera
intrinsic parameters.</p>

<h3 id="fiducial_slam-fiducial_slam-py">fiducial_slam fiducial_slam.py</h3>

<p>This node performs 3D Simultaneous Localization and Mapping (SLAM) from the 
fiducial transforms. For the mapping part, pairs of transforms are combined
to determine the position of fiducials based on existing observations.
For the localization part, fiducial transforms are combined with fiducial poses
to estimate the camera pose (and hence the robot pose).</p>

<h2 id="appendix-3-topics-and-parameters">Appendix 3. Topics and Parameters</h2>

<p><strong>map_file</strong> Path to the file containing the generated map (this must exist). Default <code>map.txt</code>.</p>

<p><strong>trans_file</strong> Path to a file to store all detected fidicial transforms. Default <code>trans.txt</code>.</p>

<p><strong>obs_file</strong> Path to a file to store all detected fidicial observations. Default <code>obs.txt</code>.</p>

<p><strong>odom_frame</strong> If this is set to a non-empty string, then the result of the localization is published as a correction to odometry.
For example, the odometry publishes the tf from map to odom, and this node publishes the tf from odom to base_link, with the tf from
map to odom removed. Default: not set.</p>

<p><strong>camera_frame</strong> The name of the camera frame.  Default <code>camera</code>.</p>

<p><strong>map_frame</strong> The name of the map (world) frame.  Default <code>map</code>.</p>

<p><strong>pose_frame</strong> The frame for our tf. Default <code>base_link</code>.</p>

<p><strong>publish_tf</strong> If <code>true</code>, transforms are published. Default <code>true</code>.</p>

<p><strong>republish_tf</strong> If <code>true</code>, transforms are republished until a new pose is calculated. Default <code>true</code>.</p>

<p><strong>mapping_mode</strong> If <code>true</code> the map updated and saved more frequently.</p>

<p><strong>use_external_pose</strong> If <code>true</code> then the node will attempt to use an external 
estimate of the robot pose (eg from AMCL) to estimate the pose of fiducials
if no known fiducials are observed.</p>

<p><strong>future</strong> Amount of time (in seconds) to future-date published transforms.
Default 0.0.</p>

<h4 id="published-topics">Published Topics</h4>

<p><strong>fiducuals</strong> A topic of <code>visualization_msgs/Marker</code> messages that can be viewed
in rviz for debugging.</p>

<p><strong>fidicual_pose</strong> a topic of <code>geometry_msgs/PoseWithCovarianceStamped</code> containing
the computed pose.</p>

<p><strong>tf</strong> Transforms</p>

<h4 id="subscribed-topics">Subscribed Topics</h4>

<p><strong>fiducial_transforms</strong> A topic of <code>fiducial_pose/FiducialTransform</code> messages with
fiducial pose.</p>

<p><strong>tf</strong> Transforms</p>

<h3 id="fiducial_slam-init_amcl-py">fiducial_slam init_amcl.py</h3>

<p>This node will reinitialize amcl by republishing the pose reported from 
fiducial_slamp.py to amcl as an initial pose.</p>

<h4 id="parameters">Parameters</h4>

<p><strong>cov_thresh</strong> The threshold of covariance reported in <em>amcl_pose</em> for
reinitializing it.  Default 0.2.</p>

<h4 id="published-topics">Published Topics</h4>

<p><strong>initial_pose</strong> (geometry_msgs/PoseWithCovarianceStamped) The initial pose 
sent to AMCL</p>

<h4 id="subscribed-topics">Subscribed Topics</h4>

<p><strong>amcl_pose</strong> (geometry_msgs/PoseWithCovarianceStamped) The pose from AMCL. The
covariance of this is examined to determine if AMCL needs re-initializing.</p>

<p><strong>fiducial_pose</strong> (geometry_msgs/PoseWithCovarianceStamped) The pose from 
fiducial_slam.py</p>

<h2 id="appendix-4-cameras">Appendix 4. Cameras</h2>

<p>If you are not using a Ubiquity Robotics robot, you will need to install a camera and hook it into ROS.</p>

<h3 id="raspberry-pi-camera">Raspberry Pi Camera</h3>

<p>The
  <a href="https://www.raspberrypi.org/products/raspberry-pi-2-model-b/">Raspberry Pi 2 Model B</a>
is a 900MHz quad core ARM7 single board computer with 1GB or RAM.
It has a variety of connectors including a CSI MIPI camera connector
for their
  <a href="https://www.raspberrypi.org/products/camera-module/">Rapsberry Pi Camera</a>
which has some
  <a href="https://www.raspberrypi.org/documentation/hardware/camera.md">nice specifications</a>.</p>

<p>We currently recommend using the raspicam_node for this camera
  <a href="https://github.com/UbiquityRobotics/raspicam_node">raspicam_node</a></p>

<h2 id="calibrating-a-camera">Calibrating a camera</h2>

<p>The fiducials package contains a calibration file for the raspberry 
PI 2 camera.  The procedure for calibrating a camera is only necessary
if you change the lens or image size used</p>

<p>The
  <a href="http://wiki.ros.org/camera_calibration/Tutorials/MonocularCalibration">Monocular Camera Calibration tutorial</a>
shows how to calibrate a single camera.</p>

<p>The
  <a href="http://wiki.ros.org/camera_calibration/Tutorials/StereoCalibration?action=AttachFile&amp;do=view&amp;target=check-108.pdf">8x6 checkerboard</a>
and the
  <a href="http://wiki.ros.org/camera_calibration/Tutorials/StereoCalibration?action=AttachFile&amp;do=view&amp;target=check_7x6_108mm.pdf">7x6 checkerboard</a>
are rather large and require specialized printers to print out at
full scale.  They can be printed on more common printer sizes
with auto scaling turned on.  Be sure to carefully measure the
square size in millimeters and convert to meters by dividing by 1000.</p>

<p>Assuming a checker board with 38mm squares, the following command can be used
to calibrate the camera:</p>
<div class="highlight"><pre><code class="language-" data-lang="">    rosrun camera_calibration cameracalibrator.py camera:=pgr_camera_node image:=pgr_camera_node/image_raw --size 8x6 --square 0.038 --no-service-check
</code></pre></div>
<p>For the Raspberry Pi 2 camera:</p>
<div class="highlight"><pre><code class="language-" data-lang=""># On Rasperry Pi:
roslaunch fiducial_detect raspicam.launch
    # Note: This launch file refers to a calibration file that
    # probably does not exist.  The resulting error is OK.

# On a laptop/desktop with ROS_MASTER_URI and ROS_HOSTNAME
# env. variables set.
    rosrun camera_calibration cameracalibrator.py camera:=camera image:=camera_node/image_raw --size 8x6 --square 0.038 --no-service-check
</code></pre></div>
<p>Read the
  <a href="http://wiki.ros.org/camera_calibration/Tutorials/MonocularCalibration">Monocular Calibration</a>
tutorial.  When the calibrator comes up, the [Calibrate], [Save],
and [Commit] buttons are dimmed out.  After the [Calibrate]
button shows up, click on it <em>once</em>.   After the [Save] and [Commit]
buttons show up, click on the [Save] button <em>once</em>.  Do not waste
your time clicking on [Commit], that feature is not supported by
<code>gscam</code>.</p>

<p>The resulting calibration is written into <code>/tmp/calibrabrationdata.tar.gz</code>.
Unpack the data as follows:</p>
<div class="highlight"><pre><code class="language-" data-lang="">    cd /tmp
    mkdir camara_data
    cd camera_data
    gunzip -c ../calibrationdata.tar.gz | tar xvf -
</code></pre></div>
<p>Now you get to convert the file <code>ost.ini</code> to a <code>.yaml</code> file.</p>
<div class="highlight"><pre><code class="language-" data-lang="">    rosrun camera_calibration_parsers ost.ini camera_WIDTHxHEIGHT.yaml
mkdir -p ~/.ros/slam
cp camera_WIDTHxHEIGHT.yaml ~/.ros/slam
</code></pre></div>
<p>where <em>WIDTH</em> is the image width and <em>HEIGHT</em> is the image height.
Make sure that <code>.../fiducials/fiducial_detect/launch/raspi.launch</code>
points to this file:</p>
<div class="highlight"><pre><code class="language-" data-lang="">    &lt;param name="camera_info_url"
           value="file:///home/ubuntu.ros/slam/raspi_WIDTHxHEIGHT.yaml"/&gt;
</code></pre></div>
<p>After this step, when you run the camera, you should no longer
get the calibration file error.</p>
</div>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-ardent">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>ardent</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-jade">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>jade</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-hydro">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>hydro</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>


<script type="text/javascript">
  $(document).ready(function() {
    setupDistroSwitch("crystal");
  });
</script>

      </div>
    </div>

    <footer class="site-footer">
  <div class="wrapper">
    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-4 col-md-4">
          
            <a href="https://github.com/ros-infrastructure" title="Find rosindex in Github">
            <span class="icon  icon--github">
              <svg viewBox="0 0 16 16">
                <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>

            <span class="username">ros-infrastructure</span>
          </a>
          |
          <em>generated on 2019-01-24</em>
        
        </div>
        <div class="col-sm-8 col-md-8 text-right">
          <p class="text">a community-maintained index of robotics software
 | <a href="/privacy.txt">privacy</a></p>
        </div>
      </div>
    </div>
  </div>

</footer>


  </body>

</html>
